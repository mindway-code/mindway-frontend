<!-- <h5 class="mb-3">Agendar Consulta</h5> -->
<hr class="w-75 text-black-50">
<div class="d-flex align-items-start justify-content-evenly flex-wrap  w-100 my-3 mb-3 py-3 gap-3">

  <div class="cta-agendamento bg-body py-3 border rounded d-flex flex-column align-items-center justify-content-center text-center mb-4" style="min-height: 430px;">
    <div class="cta-content position-relative" style="z-index:2; max-width: 500px; margin: auto;">
      <h4 class="fw-bold mb-3" style="color:#006c70;">
        Transforme a rotina dos seus atendimentos!
      </h4>
      <p class="lead mb-2 text-muted" style="color:#23232e;">
        Agende, organize e potencialize cada sessão.<br>
        O bem-estar do seu paciente em primeiro lugar.
      </p>
    </div>

    <img src="assets/img/consult3.png" class="cta-bg-img "
    style="object-fit: cover; opacity: 0.43; border-radius: 50%; width: 250px; height: auto;">


  </div>


  <div class="calendar d-flex flex-column align-items-center justify-content-center bg-body p-3 border rounded">
    <h5 class="mb-3">Meu calendário</h5>
    <app-calendar></app-calendar>
  </div>

<hr class="w-75 text-black-50">
  <div class="appointments-list bg-body border">
    <h5 class="title">Meus Agendamentos</h5>
    <div *ngIf="appointments.length === 0" class="text-muted">Nenhum agendamento.</div>
      <div class="d-flex gap-3 mb-3 flex-wrap align-items-end">
        <div>
          <label for="searchName" class="form-label mb-1">Pesquisar por nome:</label>
          <input
            id="searchName"
            type="text"
            class="form-control"
            [value]="nameFilter"
            (input)="onNameChange($event)"
            placeholder="Nome do paciente..."
            style="min-width: 180px;"
          >
        </div>
        <div>
          <label for="searchDate" class="form-label mb-1">Pesquisar por data:</label>
          <input
            id="searchDate"
            type="date"
            class="form-control"
            [value]="dateFilter"
            (input)="onDateChange($event)"
            style="min-width: 155px;"
          >
        </div>
      </div>

    <!-- Cards em Grid responsivo -->
    <div class="appt-container d-flex gap-4 " *ngIf="appointments.length > 0">

      <div class="appt-card card " *ngFor="let appt of appointments">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-person-circle fs-4 me-2"></i>
              <div>
                <strong>Paciente:</strong> {{ appt.patient?.name || '-' }} {{appt.patient?.surname || '-'}} <br>
                <span class="text-muted small">{{ appt.provider?.name || '-' }}</span>
              </div>
            </div>
            <div class="small mb-1">
              <strong>Data:</strong> {{ appt.date | date:'dd/MM/yyyy' }}<br>
              <strong>Hora:</strong> {{ appt.time }}
            </div>
            <div class="mb-2">
              <span class="badge bg-success" *ngIf="appt.status === 'CONFIRMADO'">Concluído</span>
              <span class="badge bg-warning text-dark" *ngIf="appt.status === 'PENDENTE'">Pendente</span>
              <span class="badge bg-secondary" *ngIf="appt.status !== 'CONFIRMADO' && appt.status !== 'PENDENTE'">{{ appt.status }}</span>
            </div>
            <div>
              <small class="my-3">Opções:</small>
            </div>
            <div class="d-flex justify-content-end">
              <button class="btn btn-sm me-2" title="Confirmar" (click)="openConfirmModal(appt)">
                <i class="bi bi-check-circle "></i>
              </button>
              <button class="btn btn-sm me-2" title="Editar" (click)="openEditModal(appt)">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-sm" title="Cancelar" (click)="openDeleteModal(appt)">
                <i class="bi bi-x-circle"></i>
              </button>
            </div>
          </div>
      </div>
    </div>

    <!-- Paginação Bootstrap-like -->
    <nav *ngIf="appointmentsMeta && appointmentsMeta.totalPages > 1" class="pagination-container my-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="appointmentsMeta.currentPage === 1">
          <button class="page-link text-dark" (click)="loadAppointments(appointmentsMeta.currentPage - 1)">Anterior</button>
        </li>
        <li
          class="page-item"
          *ngFor="let i of [].constructor(appointmentsMeta.totalPages); let idx = index"
          [class.active]="appointmentsMeta.currentPage === idx + 1">
          <button class="page-link" (click)="loadAppointments(idx + 1)">
            {{ idx + 1 }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="appointmentsMeta.currentPage === appointmentsMeta.totalPages">
          <button class="page-link text-dark" (click)="loadAppointments(appointmentsMeta.currentPage + 1)">Próxima</button>
        </li>
      </ul>
    </nav>
  </div>


</div>

<!-- MODAL GENÉRICO -->
<div class="modal-bg" *ngIf="showEditModal">
  <div class="modal-card" style="max-width: 390px">
    <h5 *ngIf="modalAction === 'edit'">Editar Agendamento</h5>
    <h5 *ngIf="modalAction === 'confirm'">Confirmar Agendamento</h5>
    <h5 *ngIf="modalAction === 'delete'">Cancelar Agendamento</h5>
    <div *ngIf="selectedAppt">

      <!-- Editar -->
      <form *ngIf="modalAction === 'edit'" [formGroup]="editForm" (ngSubmit)="submitEdit()">
      <div class="mb-2">
        <label class="fw-semibold mb-1">Paciente</label><br>
        <span class="badge small text-muted py-2">
          {{ selectedAppt.patient?.name }} {{ selectedAppt.patient?.surname }}
        </span>
      </div>
        <div class="mb-2">
          <label>Data</label>
          <input type="date" class="form-control" formControlName="date">
        </div>
        <div class="mb-2">
          <label>Hora</label>
          <input type="time" class="form-control" formControlName="time">
        </div>
        <div class="mb-2">
          <label>Status</label>
          <select class="form-select" formControlName="status">
            <option value="PENDENTE">PENDENTE</option>
            <option value="CONFIRMADO">CONFIRMADO</option>
          </select>
        </div>
        <div class="mb-2">
          <label>Observação</label>
          <textarea class="form-control" formControlName="notes"></textarea>
        </div>
        <button class="btn btn-success w-100" [disabled]="loadingModal">
          {{ loadingModal ? 'Salvando...' : 'Salvar alterações' }}
        </button>
        <div class="text-danger mt-2" *ngIf="errorModal">{{ errorModal }}</div>
      </form>

      <!-- Confirmar -->
      <div *ngIf="modalAction === 'confirm'" class="text-center">
        <p>Deseja <b>CONFIRMAR</b> este agendamento?</p>
        <div class="mb-3">
          <strong>{{ selectedAppt.date | date:'dd/MM/yyyy' }} às {{ selectedAppt.time }}</strong>
        </div>
        <button class="btn btn-success w-100 mb-2" [disabled]="loadingModal" (click)="submitConfirm()">
          {{ loadingModal ? 'Confirmando...' : 'Confirmar' }}
        </button>
        <button class="btn btn-outline-secondary w-100" (click)="closeModal()">Cancelar</button>
        <div class="text-danger mt-2" *ngIf="errorModal">{{ errorModal }}</div>
      </div>

      <!-- Deletar -->
      <div *ngIf="modalAction === 'delete'" class="text-center">
        <p>Tem certeza que deseja <b>CANCELAR</b> este agendamento?</p>
        <div class="mb-3">
          <strong>{{ selectedAppt.date | date:'dd/MM/yyyy' }} às {{ selectedAppt.time }}</strong>
        </div>
        <button class="btn btn-danger w-100 mb-2" [disabled]="loadingModal" (click)="submitDelete()">
          {{ loadingModal ? 'Cancelando...' : 'Cancelar Agendamento' }}
        </button>
        <button class="btn btn-outline-secondary w-100" (click)="closeModal()">Fechar</button>
        <div class="text-danger mt-2" *ngIf="errorModal">{{ errorModal }}</div>
      </div>
    </div>
    <div class="modal-actions mt-3" *ngIf="modalAction === 'edit'">
      <button class="btn btn-outline-secondary w-100" (click)="closeModal()">Fechar</button>
    </div>
  </div>
</div>

<!-- <app-appointment></app-appointment> -->
