<div class="task-container">
	<div class="task-header mb-4">
		<h2>Tarefas do Usuário</h2>
		<p class="text-muted">Veja, filtre e conclua suas tarefas de atendimento.</p>
		<div class="search-bar mb-3">
			<input type="text" class="form-control" placeholder="Buscar tarefa..." [(ngModel)]="searchTerm" (input)="filterTasks()">
		</div>
	</div>

	<div *ngIf="loading" class="text-center my-5">
		<div class="spinner-border text-accent" role="status"></div>
	</div>

	<div class="d-flex flex-wrap gap-4 task-list-container" *ngIf="!loading">
		<div class="task-list" *ngFor="let task of filteredTasks">
			<div class="card task-card shadow-sm rounded-4 h-100">
				<div class="card-body d-flex flex-column">
					<div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
						<h6 class="mb-0">
							<i class="bi bi-clipboard-check me-2 text-dark"></i>
							{{ task.description || 'Sem descrição' }}
						</h6>
						<span class="badge" [ngClass]="task.status === 'done' ? 'bg-success' : 'bg-warning text-dark'">
							{{ task.status === 'done' ? 'Concluída' : 'Pendente' }}
						</span>
					</div>
					<div class="mb-2 text-muted">
						<i class="bi bi-calendar-event me-1"></i> {{ task.created_at | date:'dd/MM/yyyy HH:mm' }}
					</div>
					<div class="mb-2">
						<label class="form-label">Descrição</label>
						<div class="task-desc">{{ task.description }}</div>
					</div>
					<div *ngIf="task.status !== 'done'" class="mt-auto">
						<label class="form-label">Feedback ao concluir</label>
						<textarea class="form-control mb-2" [(ngModel)]="feedbacks[task.id]" rows="2" placeholder="Deixe um feedback..."></textarea>
						<button class="btn btn-color text-white w-auto align-self-center" (click)="markCompleted(task)">
							<i class="bi bi-check-circle me-2"></i> Conluir
						</button>
					</div>
					<div *ngIf="task.status === 'done'" class="mt-auto">
						<div class="alert alert-success mt-2 mb-0 p-2 text-center">
							<i class="bi bi-check-circle-fill me-1"></i> Tarefa concluída
						</div>
					</div>
				</div>
			</div>
		</div>
		<div *ngIf="!loading && filteredTasks.length === 0" class="text-muted text-center w-100 py-5">
			Nenhuma tarefa encontrada.
		</div>
	</div>
</div>
